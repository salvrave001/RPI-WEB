# RPI-WEB

Веб-приложение для управления освещением в комнате через Raspberry Pi. Система автоматически включает свет, когда на улице темно (по показаниям датчика или по расписанию), и позволяет управлять режимами удалённо из браузера.

## Возможности

- Автоматическое управление освещением по датчику или расписанию.
- Ручное включение и выключение света из веб-интерфейса.
- Настройка порога срабатывания автоматического режима.
- REST API для интеграции с другими системами умного дома.

## Аппаратные требования

- Raspberry Pi с установленной Raspberry Pi OS.
- Реле/ключ для управления светильником, подключённый к GPIO (по умолчанию пин 17).
- Датчик освещённости (например, LDR с RC-цепью), подключённый к GPIO и доступный через `gpiozero.LightSensor` (опционально).

Если датчик не подключён, приложение использует виртуальный сенсор, который определяет "темноту" по времени: темно с 21:00 до 06:00 (настраивается переменными окружения).

## Установка и запуск

1. Установите Python 3.9+ и создайте виртуальное окружение:

   ```bash
   python3 -m venv .venv
   source .venv/bin/activate
   ```

2. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

3. Установите переменные окружения при необходимости:

   - `USE_GPIO=1` — использовать реальные GPIO (по умолчанию выключено).
   - `RELAY_PIN` — номер GPIO-пина для реле (по умолчанию 17).
   - `SENSOR_PIN` — номер GPIO-пина для датчика освещённости. Если не задан, используется расписание по времени.
   - `DARKNESS_THRESHOLD` — порог, при котором считается темно (0–1, по умолчанию 0.3).
   - `FLASK_HOST`, `FLASK_PORT` — адрес и порт веб-сервера (по умолчанию `0.0.0.0:8000`).

4. Запустите веб-приложение:

   ```bash
   python app.py
   ```

5. Откройте браузер на ПК и перейдите по адресу `http://<IP Raspberry Pi>:8000`.

## Структура проекта

- `app.py` — Flask-приложение и API.
- `rpilight/controller.py` — логика управления светом.
- `rpilight/sensors.py` — абстракции датчиков.
- `rpilight/templates/` — шаблоны веб-интерфейса.
- `rpilight/static/` — статические ресурсы (JS и стили).

## Остановка приложения

Нажмите `Ctrl+C` в терминале, где запущено приложение. Для корректного завершения фоновых потоков рекомендуется закрывать приложение именно так.
